# events {}

# http {
#     server {
#         listen 80;
#         server_name dev.iatnih.pp.ua prod.iatnih.pp.ua;
#         return 301 https://$host$request_uri;
#     }

#     server {
#         listen 443 ssl;
#         server_name dev.iatnih.pp.ua;

#         ssl_certificate /etc/letsencrypt/live/dev.iatnih.pp.ua/fullchain.pem;
#         ssl_certificate_key /etc/letsencrypt/live/dev.iatnih.pp.ua/privkey.pem;

#         location / {
#             root /usr/share/nginx/html_dev;
#             index index.html;
#         }
#     }

#     server {
#         listen 443 ssl;
#         server_name prod.iatnih.pp.ua;

#         ssl_certificate /etc/letsencrypt/live/prod.iatnih.pp.ua/fullchain.pem;
#         ssl_certificate_key /etc/letsencrypt/live/prod.iatnih.pp.ua/privkey.pem;

#         location / {
#             root /usr/share/nginx/html_prod;
#             index index.html;
#         }
#     }
# }


events {}

http {
    # Редірект з HTTP на HTTPS для обох доменів
    server {
        listen 80;
        server_name dev.iatnih.pp.ua prod.iatnih.pp.ua;
        return 301 https://$host$request_uri;
    }

    # Сервер для dev з проксі на Node.js додаток
    server {
        listen 443 ssl;
        server_name dev.iatnih.pp.ua;

        ssl_certificate /etc/letsencrypt/live/dev.iatnih.pp.ua/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/dev.iatnih.pp.ua/privkey.pem;

        # location / {
        #     proxy_pass http://node_dev:3000;   # node_dev — назва сервісу в docker-compose для dev
        #     proxy_http_version 1.1;
        #     proxy_set_header Upgrade $http_upgrade;
        #     proxy_set_header Connection 'upgrade';
        #     proxy_set_header Host $host;
        #     proxy_cache_bypass $http_upgrade;
        # }
        location / {
            proxy_pass http://node-app:3000;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Сервер для prod з проксі на Node.js додаток
    server {
        listen 443 ssl;
        server_name prod.iatnih.pp.ua;

        ssl_certificate /etc/letsencrypt/live/prod.iatnih.pp.ua/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/prod.iatnih.pp.ua/privkey.pem;

        # location / {
        #     proxy_pass http://node_prod:3000;  # node_prod — назва сервісу для прод
        #     proxy_http_version 1.1;
        #     proxy_set_header Upgrade $http_upgrade;
        #     proxy_set_header Connection 'upgrade';
        #     proxy_set_header Host $host;
        #     proxy_cache_bypass $http_upgrade;
        # }
        location / {
            proxy_pass http://node-app:3000;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}
